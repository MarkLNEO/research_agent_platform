revoke delete on table "public"."account_signals" from "anon";

revoke insert on table "public"."account_signals" from "anon";

revoke references on table "public"."account_signals" from "anon";

revoke select on table "public"."account_signals" from "anon";

revoke trigger on table "public"."account_signals" from "anon";

revoke truncate on table "public"."account_signals" from "anon";

revoke update on table "public"."account_signals" from "anon";

revoke delete on table "public"."account_signals" from "authenticated";

revoke insert on table "public"."account_signals" from "authenticated";

revoke references on table "public"."account_signals" from "authenticated";

revoke select on table "public"."account_signals" from "authenticated";

revoke trigger on table "public"."account_signals" from "authenticated";

revoke truncate on table "public"."account_signals" from "authenticated";

revoke update on table "public"."account_signals" from "authenticated";

revoke delete on table "public"."account_signals" from "service_role";

revoke insert on table "public"."account_signals" from "service_role";

revoke references on table "public"."account_signals" from "service_role";

revoke select on table "public"."account_signals" from "service_role";

revoke trigger on table "public"."account_signals" from "service_role";

revoke truncate on table "public"."account_signals" from "service_role";

revoke update on table "public"."account_signals" from "service_role";

revoke delete on table "public"."bulk_research_jobs" from "anon";

revoke insert on table "public"."bulk_research_jobs" from "anon";

revoke references on table "public"."bulk_research_jobs" from "anon";

revoke select on table "public"."bulk_research_jobs" from "anon";

revoke trigger on table "public"."bulk_research_jobs" from "anon";

revoke truncate on table "public"."bulk_research_jobs" from "anon";

revoke update on table "public"."bulk_research_jobs" from "anon";

revoke delete on table "public"."bulk_research_jobs" from "authenticated";

revoke insert on table "public"."bulk_research_jobs" from "authenticated";

revoke references on table "public"."bulk_research_jobs" from "authenticated";

revoke select on table "public"."bulk_research_jobs" from "authenticated";

revoke trigger on table "public"."bulk_research_jobs" from "authenticated";

revoke truncate on table "public"."bulk_research_jobs" from "authenticated";

revoke update on table "public"."bulk_research_jobs" from "authenticated";

revoke delete on table "public"."bulk_research_jobs" from "service_role";

revoke insert on table "public"."bulk_research_jobs" from "service_role";

revoke references on table "public"."bulk_research_jobs" from "service_role";

revoke select on table "public"."bulk_research_jobs" from "service_role";

revoke trigger on table "public"."bulk_research_jobs" from "service_role";

revoke truncate on table "public"."bulk_research_jobs" from "service_role";

revoke update on table "public"."bulk_research_jobs" from "service_role";

revoke delete on table "public"."bulk_research_tasks" from "anon";

revoke insert on table "public"."bulk_research_tasks" from "anon";

revoke references on table "public"."bulk_research_tasks" from "anon";

revoke select on table "public"."bulk_research_tasks" from "anon";

revoke trigger on table "public"."bulk_research_tasks" from "anon";

revoke truncate on table "public"."bulk_research_tasks" from "anon";

revoke update on table "public"."bulk_research_tasks" from "anon";

revoke delete on table "public"."bulk_research_tasks" from "authenticated";

revoke insert on table "public"."bulk_research_tasks" from "authenticated";

revoke references on table "public"."bulk_research_tasks" from "authenticated";

revoke select on table "public"."bulk_research_tasks" from "authenticated";

revoke trigger on table "public"."bulk_research_tasks" from "authenticated";

revoke truncate on table "public"."bulk_research_tasks" from "authenticated";

revoke update on table "public"."bulk_research_tasks" from "authenticated";

revoke delete on table "public"."bulk_research_tasks" from "service_role";

revoke insert on table "public"."bulk_research_tasks" from "service_role";

revoke references on table "public"."bulk_research_tasks" from "service_role";

revoke select on table "public"."bulk_research_tasks" from "service_role";

revoke trigger on table "public"."bulk_research_tasks" from "service_role";

revoke truncate on table "public"."bulk_research_tasks" from "service_role";

revoke update on table "public"."bulk_research_tasks" from "service_role";

revoke delete on table "public"."chats" from "anon";

revoke insert on table "public"."chats" from "anon";

revoke references on table "public"."chats" from "anon";

revoke select on table "public"."chats" from "anon";

revoke trigger on table "public"."chats" from "anon";

revoke truncate on table "public"."chats" from "anon";

revoke update on table "public"."chats" from "anon";

revoke delete on table "public"."chats" from "authenticated";

revoke insert on table "public"."chats" from "authenticated";

revoke references on table "public"."chats" from "authenticated";

revoke select on table "public"."chats" from "authenticated";

revoke trigger on table "public"."chats" from "authenticated";

revoke truncate on table "public"."chats" from "authenticated";

revoke update on table "public"."chats" from "authenticated";

revoke delete on table "public"."chats" from "service_role";

revoke insert on table "public"."chats" from "service_role";

revoke references on table "public"."chats" from "service_role";

revoke select on table "public"."chats" from "service_role";

revoke trigger on table "public"."chats" from "service_role";

revoke truncate on table "public"."chats" from "service_role";

revoke update on table "public"."chats" from "service_role";

revoke delete on table "public"."company_profiles" from "anon";

revoke insert on table "public"."company_profiles" from "anon";

revoke references on table "public"."company_profiles" from "anon";

revoke select on table "public"."company_profiles" from "anon";

revoke trigger on table "public"."company_profiles" from "anon";

revoke truncate on table "public"."company_profiles" from "anon";

revoke update on table "public"."company_profiles" from "anon";

revoke delete on table "public"."company_profiles" from "authenticated";

revoke insert on table "public"."company_profiles" from "authenticated";

revoke references on table "public"."company_profiles" from "authenticated";

revoke select on table "public"."company_profiles" from "authenticated";

revoke trigger on table "public"."company_profiles" from "authenticated";

revoke truncate on table "public"."company_profiles" from "authenticated";

revoke update on table "public"."company_profiles" from "authenticated";

revoke delete on table "public"."company_profiles" from "service_role";

revoke insert on table "public"."company_profiles" from "service_role";

revoke references on table "public"."company_profiles" from "service_role";

revoke select on table "public"."company_profiles" from "service_role";

revoke trigger on table "public"."company_profiles" from "service_role";

revoke truncate on table "public"."company_profiles" from "service_role";

revoke update on table "public"."company_profiles" from "service_role";

revoke delete on table "public"."company_signals" from "anon";

revoke insert on table "public"."company_signals" from "anon";

revoke references on table "public"."company_signals" from "anon";

revoke select on table "public"."company_signals" from "anon";

revoke trigger on table "public"."company_signals" from "anon";

revoke truncate on table "public"."company_signals" from "anon";

revoke update on table "public"."company_signals" from "anon";

revoke delete on table "public"."company_signals" from "authenticated";

revoke insert on table "public"."company_signals" from "authenticated";

revoke references on table "public"."company_signals" from "authenticated";

revoke select on table "public"."company_signals" from "authenticated";

revoke trigger on table "public"."company_signals" from "authenticated";

revoke truncate on table "public"."company_signals" from "authenticated";

revoke update on table "public"."company_signals" from "authenticated";

revoke delete on table "public"."company_signals" from "service_role";

revoke insert on table "public"."company_signals" from "service_role";

revoke references on table "public"."company_signals" from "service_role";

revoke select on table "public"."company_signals" from "service_role";

revoke trigger on table "public"."company_signals" from "service_role";

revoke truncate on table "public"."company_signals" from "service_role";

revoke update on table "public"."company_signals" from "service_role";

revoke delete on table "public"."credit_usage_log" from "anon";

revoke insert on table "public"."credit_usage_log" from "anon";

revoke references on table "public"."credit_usage_log" from "anon";

revoke select on table "public"."credit_usage_log" from "anon";

revoke trigger on table "public"."credit_usage_log" from "anon";

revoke truncate on table "public"."credit_usage_log" from "anon";

revoke update on table "public"."credit_usage_log" from "anon";

revoke delete on table "public"."credit_usage_log" from "authenticated";

revoke insert on table "public"."credit_usage_log" from "authenticated";

revoke references on table "public"."credit_usage_log" from "authenticated";

revoke select on table "public"."credit_usage_log" from "authenticated";

revoke trigger on table "public"."credit_usage_log" from "authenticated";

revoke truncate on table "public"."credit_usage_log" from "authenticated";

revoke update on table "public"."credit_usage_log" from "authenticated";

revoke delete on table "public"."credit_usage_log" from "service_role";

revoke insert on table "public"."credit_usage_log" from "service_role";

revoke references on table "public"."credit_usage_log" from "service_role";

revoke select on table "public"."credit_usage_log" from "service_role";

revoke trigger on table "public"."credit_usage_log" from "service_role";

revoke truncate on table "public"."credit_usage_log" from "service_role";

revoke update on table "public"."credit_usage_log" from "service_role";

revoke delete on table "public"."golden_runs" from "anon";

revoke insert on table "public"."golden_runs" from "anon";

revoke references on table "public"."golden_runs" from "anon";

revoke select on table "public"."golden_runs" from "anon";

revoke trigger on table "public"."golden_runs" from "anon";

revoke truncate on table "public"."golden_runs" from "anon";

revoke update on table "public"."golden_runs" from "anon";

revoke delete on table "public"."golden_runs" from "authenticated";

revoke insert on table "public"."golden_runs" from "authenticated";

revoke references on table "public"."golden_runs" from "authenticated";

revoke select on table "public"."golden_runs" from "authenticated";

revoke trigger on table "public"."golden_runs" from "authenticated";

revoke truncate on table "public"."golden_runs" from "authenticated";

revoke update on table "public"."golden_runs" from "authenticated";

revoke delete on table "public"."golden_runs" from "service_role";

revoke insert on table "public"."golden_runs" from "service_role";

revoke references on table "public"."golden_runs" from "service_role";

revoke select on table "public"."golden_runs" from "service_role";

revoke trigger on table "public"."golden_runs" from "service_role";

revoke truncate on table "public"."golden_runs" from "service_role";

revoke update on table "public"."golden_runs" from "service_role";

revoke delete on table "public"."guardrail_profiles" from "anon";

revoke insert on table "public"."guardrail_profiles" from "anon";

revoke references on table "public"."guardrail_profiles" from "anon";

revoke select on table "public"."guardrail_profiles" from "anon";

revoke trigger on table "public"."guardrail_profiles" from "anon";

revoke truncate on table "public"."guardrail_profiles" from "anon";

revoke update on table "public"."guardrail_profiles" from "anon";

revoke delete on table "public"."guardrail_profiles" from "authenticated";

revoke insert on table "public"."guardrail_profiles" from "authenticated";

revoke references on table "public"."guardrail_profiles" from "authenticated";

revoke select on table "public"."guardrail_profiles" from "authenticated";

revoke trigger on table "public"."guardrail_profiles" from "authenticated";

revoke truncate on table "public"."guardrail_profiles" from "authenticated";

revoke update on table "public"."guardrail_profiles" from "authenticated";

revoke delete on table "public"."guardrail_profiles" from "service_role";

revoke insert on table "public"."guardrail_profiles" from "service_role";

revoke references on table "public"."guardrail_profiles" from "service_role";

revoke select on table "public"."guardrail_profiles" from "service_role";

revoke trigger on table "public"."guardrail_profiles" from "service_role";

revoke truncate on table "public"."guardrail_profiles" from "service_role";

revoke update on table "public"."guardrail_profiles" from "service_role";

revoke delete on table "public"."icp_profiles" from "anon";

revoke insert on table "public"."icp_profiles" from "anon";

revoke references on table "public"."icp_profiles" from "anon";

revoke select on table "public"."icp_profiles" from "anon";

revoke trigger on table "public"."icp_profiles" from "anon";

revoke truncate on table "public"."icp_profiles" from "anon";

revoke update on table "public"."icp_profiles" from "anon";

revoke delete on table "public"."icp_profiles" from "authenticated";

revoke insert on table "public"."icp_profiles" from "authenticated";

revoke references on table "public"."icp_profiles" from "authenticated";

revoke select on table "public"."icp_profiles" from "authenticated";

revoke trigger on table "public"."icp_profiles" from "authenticated";

revoke truncate on table "public"."icp_profiles" from "authenticated";

revoke update on table "public"."icp_profiles" from "authenticated";

revoke delete on table "public"."icp_profiles" from "service_role";

revoke insert on table "public"."icp_profiles" from "service_role";

revoke references on table "public"."icp_profiles" from "service_role";

revoke select on table "public"."icp_profiles" from "service_role";

revoke trigger on table "public"."icp_profiles" from "service_role";

revoke truncate on table "public"."icp_profiles" from "service_role";

revoke update on table "public"."icp_profiles" from "service_role";

revoke delete on table "public"."messages" from "anon";

revoke insert on table "public"."messages" from "anon";

revoke references on table "public"."messages" from "anon";

revoke select on table "public"."messages" from "anon";

revoke trigger on table "public"."messages" from "anon";

revoke truncate on table "public"."messages" from "anon";

revoke update on table "public"."messages" from "anon";

revoke delete on table "public"."messages" from "authenticated";

revoke insert on table "public"."messages" from "authenticated";

revoke references on table "public"."messages" from "authenticated";

revoke select on table "public"."messages" from "authenticated";

revoke trigger on table "public"."messages" from "authenticated";

revoke truncate on table "public"."messages" from "authenticated";

revoke update on table "public"."messages" from "authenticated";

revoke delete on table "public"."messages" from "service_role";

revoke insert on table "public"."messages" from "service_role";

revoke references on table "public"."messages" from "service_role";

revoke select on table "public"."messages" from "service_role";

revoke trigger on table "public"."messages" from "service_role";

revoke truncate on table "public"."messages" from "service_role";

revoke update on table "public"."messages" from "service_role";

revoke delete on table "public"."research_outputs" from "anon";

revoke insert on table "public"."research_outputs" from "anon";

revoke references on table "public"."research_outputs" from "anon";

revoke select on table "public"."research_outputs" from "anon";

revoke trigger on table "public"."research_outputs" from "anon";

revoke truncate on table "public"."research_outputs" from "anon";

revoke update on table "public"."research_outputs" from "anon";

revoke delete on table "public"."research_outputs" from "authenticated";

revoke insert on table "public"."research_outputs" from "authenticated";

revoke references on table "public"."research_outputs" from "authenticated";

revoke select on table "public"."research_outputs" from "authenticated";

revoke trigger on table "public"."research_outputs" from "authenticated";

revoke truncate on table "public"."research_outputs" from "authenticated";

revoke update on table "public"."research_outputs" from "authenticated";

revoke delete on table "public"."research_outputs" from "service_role";

revoke insert on table "public"."research_outputs" from "service_role";

revoke references on table "public"."research_outputs" from "service_role";

revoke select on table "public"."research_outputs" from "service_role";

revoke trigger on table "public"."research_outputs" from "service_role";

revoke truncate on table "public"."research_outputs" from "service_role";

revoke update on table "public"."research_outputs" from "service_role";

revoke delete on table "public"."research_playbooks" from "anon";

revoke insert on table "public"."research_playbooks" from "anon";

revoke references on table "public"."research_playbooks" from "anon";

revoke select on table "public"."research_playbooks" from "anon";

revoke trigger on table "public"."research_playbooks" from "anon";

revoke truncate on table "public"."research_playbooks" from "anon";

revoke update on table "public"."research_playbooks" from "anon";

revoke delete on table "public"."research_playbooks" from "authenticated";

revoke insert on table "public"."research_playbooks" from "authenticated";

revoke references on table "public"."research_playbooks" from "authenticated";

revoke select on table "public"."research_playbooks" from "authenticated";

revoke trigger on table "public"."research_playbooks" from "authenticated";

revoke truncate on table "public"."research_playbooks" from "authenticated";

revoke update on table "public"."research_playbooks" from "authenticated";

revoke delete on table "public"."research_playbooks" from "service_role";

revoke insert on table "public"."research_playbooks" from "service_role";

revoke references on table "public"."research_playbooks" from "service_role";

revoke select on table "public"."research_playbooks" from "service_role";

revoke trigger on table "public"."research_playbooks" from "service_role";

revoke truncate on table "public"."research_playbooks" from "service_role";

revoke update on table "public"."research_playbooks" from "service_role";

revoke delete on table "public"."research_results" from "anon";

revoke insert on table "public"."research_results" from "anon";

revoke references on table "public"."research_results" from "anon";

revoke select on table "public"."research_results" from "anon";

revoke trigger on table "public"."research_results" from "anon";

revoke truncate on table "public"."research_results" from "anon";

revoke update on table "public"."research_results" from "anon";

revoke delete on table "public"."research_results" from "authenticated";

revoke insert on table "public"."research_results" from "authenticated";

revoke references on table "public"."research_results" from "authenticated";

revoke select on table "public"."research_results" from "authenticated";

revoke trigger on table "public"."research_results" from "authenticated";

revoke truncate on table "public"."research_results" from "authenticated";

revoke update on table "public"."research_results" from "authenticated";

revoke delete on table "public"."research_results" from "service_role";

revoke insert on table "public"."research_results" from "service_role";

revoke references on table "public"."research_results" from "service_role";

revoke select on table "public"."research_results" from "service_role";

revoke trigger on table "public"."research_results" from "service_role";

revoke truncate on table "public"."research_results" from "service_role";

revoke update on table "public"."research_results" from "service_role";

revoke delete on table "public"."signal_activity_log" from "anon";

revoke insert on table "public"."signal_activity_log" from "anon";

revoke references on table "public"."signal_activity_log" from "anon";

revoke select on table "public"."signal_activity_log" from "anon";

revoke trigger on table "public"."signal_activity_log" from "anon";

revoke truncate on table "public"."signal_activity_log" from "anon";

revoke update on table "public"."signal_activity_log" from "anon";

revoke delete on table "public"."signal_activity_log" from "authenticated";

revoke insert on table "public"."signal_activity_log" from "authenticated";

revoke references on table "public"."signal_activity_log" from "authenticated";

revoke select on table "public"."signal_activity_log" from "authenticated";

revoke trigger on table "public"."signal_activity_log" from "authenticated";

revoke truncate on table "public"."signal_activity_log" from "authenticated";

revoke update on table "public"."signal_activity_log" from "authenticated";

revoke delete on table "public"."signal_activity_log" from "service_role";

revoke insert on table "public"."signal_activity_log" from "service_role";

revoke references on table "public"."signal_activity_log" from "service_role";

revoke select on table "public"."signal_activity_log" from "service_role";

revoke trigger on table "public"."signal_activity_log" from "service_role";

revoke truncate on table "public"."signal_activity_log" from "service_role";

revoke update on table "public"."signal_activity_log" from "service_role";

revoke delete on table "public"."signal_sets_catalog" from "anon";

revoke insert on table "public"."signal_sets_catalog" from "anon";

revoke references on table "public"."signal_sets_catalog" from "anon";

revoke select on table "public"."signal_sets_catalog" from "anon";

revoke trigger on table "public"."signal_sets_catalog" from "anon";

revoke truncate on table "public"."signal_sets_catalog" from "anon";

revoke update on table "public"."signal_sets_catalog" from "anon";

revoke delete on table "public"."signal_sets_catalog" from "authenticated";

revoke insert on table "public"."signal_sets_catalog" from "authenticated";

revoke references on table "public"."signal_sets_catalog" from "authenticated";

revoke select on table "public"."signal_sets_catalog" from "authenticated";

revoke trigger on table "public"."signal_sets_catalog" from "authenticated";

revoke truncate on table "public"."signal_sets_catalog" from "authenticated";

revoke update on table "public"."signal_sets_catalog" from "authenticated";

revoke delete on table "public"."signal_sets_catalog" from "service_role";

revoke insert on table "public"."signal_sets_catalog" from "service_role";

revoke references on table "public"."signal_sets_catalog" from "service_role";

revoke select on table "public"."signal_sets_catalog" from "service_role";

revoke trigger on table "public"."signal_sets_catalog" from "service_role";

revoke truncate on table "public"."signal_sets_catalog" from "service_role";

revoke update on table "public"."signal_sets_catalog" from "service_role";

revoke delete on table "public"."tracked_accounts" from "anon";

revoke insert on table "public"."tracked_accounts" from "anon";

revoke references on table "public"."tracked_accounts" from "anon";

revoke select on table "public"."tracked_accounts" from "anon";

revoke trigger on table "public"."tracked_accounts" from "anon";

revoke truncate on table "public"."tracked_accounts" from "anon";

revoke update on table "public"."tracked_accounts" from "anon";

revoke delete on table "public"."tracked_accounts" from "authenticated";

revoke insert on table "public"."tracked_accounts" from "authenticated";

revoke references on table "public"."tracked_accounts" from "authenticated";

revoke select on table "public"."tracked_accounts" from "authenticated";

revoke trigger on table "public"."tracked_accounts" from "authenticated";

revoke truncate on table "public"."tracked_accounts" from "authenticated";

revoke update on table "public"."tracked_accounts" from "authenticated";

revoke delete on table "public"."tracked_accounts" from "service_role";

revoke insert on table "public"."tracked_accounts" from "service_role";

revoke references on table "public"."tracked_accounts" from "service_role";

revoke select on table "public"."tracked_accounts" from "service_role";

revoke trigger on table "public"."tracked_accounts" from "service_role";

revoke truncate on table "public"."tracked_accounts" from "service_role";

revoke update on table "public"."tracked_accounts" from "service_role";

revoke delete on table "public"."usage_logs" from "anon";

revoke insert on table "public"."usage_logs" from "anon";

revoke references on table "public"."usage_logs" from "anon";

revoke select on table "public"."usage_logs" from "anon";

revoke trigger on table "public"."usage_logs" from "anon";

revoke truncate on table "public"."usage_logs" from "anon";

revoke update on table "public"."usage_logs" from "anon";

revoke delete on table "public"."usage_logs" from "authenticated";

revoke insert on table "public"."usage_logs" from "authenticated";

revoke references on table "public"."usage_logs" from "authenticated";

revoke select on table "public"."usage_logs" from "authenticated";

revoke trigger on table "public"."usage_logs" from "authenticated";

revoke truncate on table "public"."usage_logs" from "authenticated";

revoke update on table "public"."usage_logs" from "authenticated";

revoke delete on table "public"."usage_logs" from "service_role";

revoke insert on table "public"."usage_logs" from "service_role";

revoke references on table "public"."usage_logs" from "service_role";

revoke select on table "public"."usage_logs" from "service_role";

revoke trigger on table "public"."usage_logs" from "service_role";

revoke truncate on table "public"."usage_logs" from "service_role";

revoke update on table "public"."usage_logs" from "service_role";

revoke delete on table "public"."use_case_templates" from "anon";

revoke insert on table "public"."use_case_templates" from "anon";

revoke references on table "public"."use_case_templates" from "anon";

revoke select on table "public"."use_case_templates" from "anon";

revoke trigger on table "public"."use_case_templates" from "anon";

revoke truncate on table "public"."use_case_templates" from "anon";

revoke update on table "public"."use_case_templates" from "anon";

revoke delete on table "public"."use_case_templates" from "authenticated";

revoke insert on table "public"."use_case_templates" from "authenticated";

revoke references on table "public"."use_case_templates" from "authenticated";

revoke select on table "public"."use_case_templates" from "authenticated";

revoke trigger on table "public"."use_case_templates" from "authenticated";

revoke truncate on table "public"."use_case_templates" from "authenticated";

revoke update on table "public"."use_case_templates" from "authenticated";

revoke delete on table "public"."use_case_templates" from "service_role";

revoke insert on table "public"."use_case_templates" from "service_role";

revoke references on table "public"."use_case_templates" from "service_role";

revoke select on table "public"."use_case_templates" from "service_role";

revoke trigger on table "public"."use_case_templates" from "service_role";

revoke truncate on table "public"."use_case_templates" from "service_role";

revoke update on table "public"."use_case_templates" from "service_role";

revoke delete on table "public"."user_custom_criteria" from "anon";

revoke insert on table "public"."user_custom_criteria" from "anon";

revoke references on table "public"."user_custom_criteria" from "anon";

revoke select on table "public"."user_custom_criteria" from "anon";

revoke trigger on table "public"."user_custom_criteria" from "anon";

revoke truncate on table "public"."user_custom_criteria" from "anon";

revoke update on table "public"."user_custom_criteria" from "anon";

revoke delete on table "public"."user_custom_criteria" from "authenticated";

revoke insert on table "public"."user_custom_criteria" from "authenticated";

revoke references on table "public"."user_custom_criteria" from "authenticated";

revoke select on table "public"."user_custom_criteria" from "authenticated";

revoke trigger on table "public"."user_custom_criteria" from "authenticated";

revoke truncate on table "public"."user_custom_criteria" from "authenticated";

revoke update on table "public"."user_custom_criteria" from "authenticated";

revoke delete on table "public"."user_custom_criteria" from "service_role";

revoke insert on table "public"."user_custom_criteria" from "service_role";

revoke references on table "public"."user_custom_criteria" from "service_role";

revoke select on table "public"."user_custom_criteria" from "service_role";

revoke trigger on table "public"."user_custom_criteria" from "service_role";

revoke truncate on table "public"."user_custom_criteria" from "service_role";

revoke update on table "public"."user_custom_criteria" from "service_role";

revoke delete on table "public"."user_disqualifying_criteria" from "anon";

revoke insert on table "public"."user_disqualifying_criteria" from "anon";

revoke references on table "public"."user_disqualifying_criteria" from "anon";

revoke select on table "public"."user_disqualifying_criteria" from "anon";

revoke trigger on table "public"."user_disqualifying_criteria" from "anon";

revoke truncate on table "public"."user_disqualifying_criteria" from "anon";

revoke update on table "public"."user_disqualifying_criteria" from "anon";

revoke delete on table "public"."user_disqualifying_criteria" from "authenticated";

revoke insert on table "public"."user_disqualifying_criteria" from "authenticated";

revoke references on table "public"."user_disqualifying_criteria" from "authenticated";

revoke select on table "public"."user_disqualifying_criteria" from "authenticated";

revoke trigger on table "public"."user_disqualifying_criteria" from "authenticated";

revoke truncate on table "public"."user_disqualifying_criteria" from "authenticated";

revoke update on table "public"."user_disqualifying_criteria" from "authenticated";

revoke delete on table "public"."user_disqualifying_criteria" from "service_role";

revoke insert on table "public"."user_disqualifying_criteria" from "service_role";

revoke references on table "public"."user_disqualifying_criteria" from "service_role";

revoke select on table "public"."user_disqualifying_criteria" from "service_role";

revoke trigger on table "public"."user_disqualifying_criteria" from "service_role";

revoke truncate on table "public"."user_disqualifying_criteria" from "service_role";

revoke update on table "public"."user_disqualifying_criteria" from "service_role";

revoke delete on table "public"."user_prompt_config" from "anon";

revoke insert on table "public"."user_prompt_config" from "anon";

revoke references on table "public"."user_prompt_config" from "anon";

revoke select on table "public"."user_prompt_config" from "anon";

revoke trigger on table "public"."user_prompt_config" from "anon";

revoke truncate on table "public"."user_prompt_config" from "anon";

revoke update on table "public"."user_prompt_config" from "anon";

revoke delete on table "public"."user_prompt_config" from "authenticated";

revoke insert on table "public"."user_prompt_config" from "authenticated";

revoke references on table "public"."user_prompt_config" from "authenticated";

revoke select on table "public"."user_prompt_config" from "authenticated";

revoke trigger on table "public"."user_prompt_config" from "authenticated";

revoke truncate on table "public"."user_prompt_config" from "authenticated";

revoke update on table "public"."user_prompt_config" from "authenticated";

revoke delete on table "public"."user_prompt_config" from "service_role";

revoke insert on table "public"."user_prompt_config" from "service_role";

revoke references on table "public"."user_prompt_config" from "service_role";

revoke select on table "public"."user_prompt_config" from "service_role";

revoke trigger on table "public"."user_prompt_config" from "service_role";

revoke truncate on table "public"."user_prompt_config" from "service_role";

revoke update on table "public"."user_prompt_config" from "service_role";

revoke delete on table "public"."user_report_preferences" from "anon";

revoke insert on table "public"."user_report_preferences" from "anon";

revoke references on table "public"."user_report_preferences" from "anon";

revoke select on table "public"."user_report_preferences" from "anon";

revoke trigger on table "public"."user_report_preferences" from "anon";

revoke truncate on table "public"."user_report_preferences" from "anon";

revoke update on table "public"."user_report_preferences" from "anon";

revoke delete on table "public"."user_report_preferences" from "authenticated";

revoke insert on table "public"."user_report_preferences" from "authenticated";

revoke references on table "public"."user_report_preferences" from "authenticated";

revoke select on table "public"."user_report_preferences" from "authenticated";

revoke trigger on table "public"."user_report_preferences" from "authenticated";

revoke truncate on table "public"."user_report_preferences" from "authenticated";

revoke update on table "public"."user_report_preferences" from "authenticated";

revoke delete on table "public"."user_report_preferences" from "service_role";

revoke insert on table "public"."user_report_preferences" from "service_role";

revoke references on table "public"."user_report_preferences" from "service_role";

revoke select on table "public"."user_report_preferences" from "service_role";

revoke trigger on table "public"."user_report_preferences" from "service_role";

revoke truncate on table "public"."user_report_preferences" from "service_role";

revoke update on table "public"."user_report_preferences" from "service_role";

revoke delete on table "public"."user_signal_preferences" from "anon";

revoke insert on table "public"."user_signal_preferences" from "anon";

revoke references on table "public"."user_signal_preferences" from "anon";

revoke select on table "public"."user_signal_preferences" from "anon";

revoke trigger on table "public"."user_signal_preferences" from "anon";

revoke truncate on table "public"."user_signal_preferences" from "anon";

revoke update on table "public"."user_signal_preferences" from "anon";

revoke delete on table "public"."user_signal_preferences" from "authenticated";

revoke insert on table "public"."user_signal_preferences" from "authenticated";

revoke references on table "public"."user_signal_preferences" from "authenticated";

revoke select on table "public"."user_signal_preferences" from "authenticated";

revoke trigger on table "public"."user_signal_preferences" from "authenticated";

revoke truncate on table "public"."user_signal_preferences" from "authenticated";

revoke update on table "public"."user_signal_preferences" from "authenticated";

revoke delete on table "public"."user_signal_preferences" from "service_role";

revoke insert on table "public"."user_signal_preferences" from "service_role";

revoke references on table "public"."user_signal_preferences" from "service_role";

revoke select on table "public"."user_signal_preferences" from "service_role";

revoke trigger on table "public"."user_signal_preferences" from "service_role";

revoke truncate on table "public"."user_signal_preferences" from "service_role";

revoke update on table "public"."user_signal_preferences" from "service_role";

revoke delete on table "public"."users" from "anon";

revoke insert on table "public"."users" from "anon";

revoke references on table "public"."users" from "anon";

revoke select on table "public"."users" from "anon";

revoke trigger on table "public"."users" from "anon";

revoke truncate on table "public"."users" from "anon";

revoke update on table "public"."users" from "anon";

revoke delete on table "public"."users" from "authenticated";

revoke insert on table "public"."users" from "authenticated";

revoke references on table "public"."users" from "authenticated";

revoke select on table "public"."users" from "authenticated";

revoke trigger on table "public"."users" from "authenticated";

revoke truncate on table "public"."users" from "authenticated";

revoke update on table "public"."users" from "authenticated";

revoke delete on table "public"."users" from "service_role";

revoke insert on table "public"."users" from "service_role";

revoke references on table "public"."users" from "service_role";

revoke select on table "public"."users" from "service_role";

revoke trigger on table "public"."users" from "service_role";

revoke truncate on table "public"."users" from "service_role";

revoke update on table "public"."users" from "service_role";

set check_function_bodies = off;

CREATE OR REPLACE FUNCTION public.approve_user(user_id_to_approve uuid, admin_email text, notes text DEFAULT NULL::text)
 RETURNS boolean
 LANGUAGE plpgsql
 SECURITY DEFINER
AS $function$
BEGIN
  -- Only mlerner@rebarhq.ai can approve
  IF admin_email != 'mlerner@rebarhq.ai' THEN
    RAISE EXCEPTION 'Unauthorized: Only mlerner@rebarhq.ai can approve users';
  END IF;

  -- Update user to approved and grant credits
  UPDATE users
  SET 
    approval_status = 'approved',
    approved_by = (
      SELECT id FROM users WHERE email = admin_email
    ),
    approved_at = now(),
    approval_notes = notes,
    credits_remaining = 1000,
    credits_total = 1000,
    updated_at = now()
  WHERE id = user_id_to_approve;

  RETURN FOUND;
END;
$function$
;

CREATE OR REPLACE FUNCTION public.check_user_credits(user_id_param uuid)
 RETURNS TABLE(has_credits boolean, credits_remaining integer, approval_status text)
 LANGUAGE plpgsql
 SECURITY DEFINER
AS $function$
BEGIN
  RETURN QUERY
  SELECT 
    (u.credits_remaining > 0) as has_credits,
    u.credits_remaining,
    u.approval_status
  FROM users u
  WHERE u.id = user_id_param;
END;
$function$
;

CREATE OR REPLACE FUNCTION public.deduct_credits(user_id_param uuid, credits_to_deduct integer, tokens_used_param integer, chat_id_param uuid DEFAULT NULL::uuid, query_type_param text DEFAULT NULL::text)
 RETURNS TABLE(success boolean, new_balance integer, message text)
 LANGUAGE plpgsql
 SECURITY DEFINER
AS $function$
DECLARE
  current_credits INTEGER;
BEGIN
  -- Get current credits
  SELECT credits_remaining INTO current_credits
  FROM users
  WHERE id = user_id_param;

  -- Check if enough credits
  IF current_credits < credits_to_deduct THEN
    RETURN QUERY SELECT FALSE, current_credits, 'Insufficient credits';
    RETURN;
  END IF;

  -- Deduct credits
  UPDATE users
  SET 
    credits_remaining = credits_remaining - credits_to_deduct,
    credits_total_used = COALESCE(credits_total_used, 0) + credits_to_deduct
  WHERE id = user_id_param;

  -- Log usage
  INSERT INTO credit_usage_log (user_id, chat_id, tokens_used, credits_used, query_type)
  VALUES (user_id_param, chat_id_param, tokens_used_param, credits_to_deduct, query_type_param);

  -- Return success
  SELECT credits_remaining INTO current_credits
  FROM users
  WHERE id = user_id_param;

  RETURN QUERY SELECT TRUE, current_credits, 'Credits deducted successfully';
END;
$function$
;

CREATE OR REPLACE FUNCTION public.deduct_user_credits(p_user_id uuid, p_credits integer)
 RETURNS void
 LANGUAGE plpgsql
 SECURITY DEFINER
AS $function$
BEGIN
  UPDATE users
  SET 
    credits_remaining = GREATEST(0, credits_remaining - p_credits),
    updated_at = now()
  WHERE id = p_user_id;
END;
$function$
;

CREATE OR REPLACE FUNCTION public.handle_new_user()
 RETURNS trigger
 LANGUAGE plpgsql
 SECURITY DEFINER
 SET search_path TO 'public'
AS $function$
BEGIN
  -- Auto-approve special emails
  IF NEW.email IN ('mlerner@rebarhq.ai', 'jesse@nevereverordinary.com') THEN
    INSERT INTO public.users (
      id, email, name, credits_remaining, credits_total,
      approval_status, approved_at, created_at, updated_at
    )
    VALUES (
      NEW.id,
      NEW.email,
      COALESCE(NEW.raw_user_meta_data->>'name', NEW.email),
      10000,
      10000,
      'approved',
      now(),
      now(),
      now()
    )
    ON CONFLICT (id) DO NOTHING;
  ELSE
    -- Regular users start pending with 0 credits until approved
    INSERT INTO public.users (
      id, email, name, credits_remaining, credits_total,
      approval_status, created_at, updated_at
    )
    VALUES (
      NEW.id,
      NEW.email,
      COALESCE(NEW.raw_user_meta_data->>'name', NEW.email),
      0,
      0,
      'pending',
      now(),
      now()
    )
    ON CONFLICT (id) DO NOTHING;
  END IF;

  RETURN NEW;
END;
$function$
;

CREATE OR REPLACE FUNCTION public.mark_account_researched()
 RETURNS trigger
 LANGUAGE plpgsql
AS $function$
BEGIN
  -- If a new research_output is created for a tracked account, update it
  UPDATE tracked_accounts
  SET 
    last_researched_at = NOW(),
    latest_research_id = NEW.id,
    icp_fit_score = NEW.icp_fit_score,
    updated_at = NOW()
  WHERE user_id = NEW.user_id
    AND company_name = NEW.subject
    AND monitoring_enabled = TRUE;
  
  RETURN NEW;
END;
$function$
;

CREATE OR REPLACE FUNCTION public.notify_new_user_signup()
 RETURNS trigger
 LANGUAGE plpgsql
 SECURITY DEFINER
AS $function$
DECLARE
  webhook_url TEXT;
BEGIN
  -- Only send notification for non-admin users who are pending
  IF NEW.email != 'mlerner@rebarhq.ai' AND NEW.approval_status = 'pending' THEN
    -- Get the webhook URL from environment (set in Supabase dashboard)
    webhook_url := current_setting('app.settings.approval_webhook_url', true);
    
    -- If webhook URL is configured, send notification
    IF webhook_url IS NOT NULL AND webhook_url != '' THEN
      PERFORM
        net.http_post(
          url := webhook_url,
          headers := jsonb_build_object(
            'Content-Type', 'application/json'
          ),
          body := jsonb_build_object(
            'user', jsonb_build_object(
              'id', NEW.id,
              'email', NEW.email,
              'name', NEW.name,
              'created_at', NEW.created_at
            )
          )
        );
    END IF;
  END IF;
  
  RETURN NEW;
END;
$function$
;

CREATE OR REPLACE FUNCTION public.reject_user(user_id_to_reject uuid, admin_email text, notes text DEFAULT NULL::text)
 RETURNS boolean
 LANGUAGE plpgsql
 SECURITY DEFINER
AS $function$
BEGIN
  -- Only mlerner@rebarhq.ai can reject
  IF admin_email != 'mlerner@rebarhq.ai' THEN
    RAISE EXCEPTION 'Unauthorized: Only mlerner@rebarhq.ai can reject users';
  END IF;

  -- Update user to rejected
  UPDATE users
  SET 
    approval_status = 'rejected',
    approved_by = (
      SELECT id FROM users WHERE email = admin_email
    ),
    approved_at = now(),
    approval_notes = notes,
    updated_at = now()
  WHERE id = user_id_to_reject;

  RETURN FOUND;
END;
$function$
;

CREATE OR REPLACE FUNCTION public.set_updated_at()
 RETURNS trigger
 LANGUAGE plpgsql
AS $function$
BEGIN
  NEW.updated_at = NOW();
  RETURN NEW;
END;
$function$
;

CREATE OR REPLACE FUNCTION public.trigger_signal_detection()
 RETURNS jsonb
 LANGUAGE plpgsql
 SECURITY DEFINER
AS $function$
DECLARE
  result jsonb;
BEGIN
  SELECT net.http_post(
    url := current_setting('app.settings.supabase_url') || '/functions/v1/detect-signals',
    headers := jsonb_build_object(
      'Authorization', 'Bearer ' || current_setting('app.settings.supabase_service_role_key'),
      'Content-Type', 'application/json'
    ),
    body := jsonb_build_object(
      'trigger', 'manual',
      'timestamp', now()
    )
  ) INTO result;

  RETURN result;
END;
$function$
;

CREATE OR REPLACE FUNCTION public.update_account_priority()
 RETURNS trigger
 LANGUAGE plpgsql
AS $function$
BEGIN
  -- Recalculate signal score for the account
  UPDATE tracked_accounts
  SET 
    signal_score = COALESCE(
      (SELECT 
        LEAST(100, SUM(score))
      FROM account_signals
      WHERE account_id = NEW.account_id
        AND dismissed = FALSE
        AND signal_date >= CURRENT_DATE - INTERVAL '90 days'
      ), 0
    ),
    priority = CASE
      WHEN COALESCE(
        (SELECT SUM(score) FROM account_signals 
         WHERE account_id = NEW.account_id 
           AND dismissed = FALSE
           AND signal_date >= CURRENT_DATE - INTERVAL '90 days'
        ), 0
      ) >= 80 THEN 'hot'
      WHEN COALESCE(
        (SELECT SUM(score) FROM account_signals 
         WHERE account_id = NEW.account_id 
           AND dismissed = FALSE
           AND signal_date >= CURRENT_DATE - INTERVAL '90 days'
        ), 0
      ) >= 60 THEN 'warm'
      ELSE 'standard'
    END,
    updated_at = NOW()
  WHERE id = NEW.account_id;
  
  RETURN NEW;
END;
$function$
;



